# shambhala data types and storage _(draft)_

<br />




## frontend web storage

* field definitions for [IndexedDB] intefaced with [localForage]

    ```typescript
    interface ItemLayout: {
        C_PUBLIC: string;
        C_UUID: string;
        C_SALT: string;
        ENC_CKP: string;
        SALT_FOR_S: string;
    }
    let
        key: string,  /* `key` is a `G_PUBLIC` */
        item: ItemLayout;
    ```

<br />




## backend database

* table

    ```sql
    CREATE TABLE IF NOT EXISTS wakantanka (...);
    ```


* structure (SQL table column definitions)

    | name | type | options | notes |
    |-----:|:-----|:--------|:-----:|
    | `id` | `bigserial` | `PRIMARY KEY NOT NULL` | Usual SQL primary key. |
    | `creation_time` | `timestamptz` | `NOT NULL DEFAULT now()` | Entry creation time. |
    | `g_public` | `varchar(56)` | `NOT NULL` | Stellar account.
    | `c_uuid` | `uuid` | `NOT NULL` | Client-generated `UUID`. |
    | `enc_skp` | `text` | `DEFAULT NULL` | Encrypted _Server Keypair_ (`S_SECRET` + `SALT_FOR_C`). |
    | `datum` | `jsonb` | `NOT NULL DEFAULT jsonb_build_object()` | Additional flags and options. |


* `datum` structure

    ```typescript
    interface DatumLayout: {
        S_PUBLIC: string;
        usageCount: number;
        failedDecryptionCount: number;
        decryptionAttemptsLeft: number;
        lastSuccessfulUsage: Date;
        lastFailure: Date;
        suspended: boolean;
        fundedBySfox: boolean;
    }

    let datum: DatumLayout;
    ```


* indexes (SQL)

    ```sql
    CREATE INDEX w_creation_time_index ON wakantanka USING btree (creation_time);
    CREATE INDEX w_g_public_index      ON wakantanka USING btree (g_public);
    CREATE INDEX w_data_gin_index      ON wakantanka USING gin   (datum);

    ```




[IndexedDB]: https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API
[localForage]: https://localforage.github.io/localForage/
